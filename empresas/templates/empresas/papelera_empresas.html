{% extends 'empresas/base_empresas.html' %}

{% block empresa_content %}

  <div class="alert alert-warning border-0 shadow-sm d-flex align-items-center" role="alert">
      <i class="fa-solid fa-triangle-exclamation fs-4 me-3"></i>
      <div>
          Estas empresas están desactivadas. Puedes <strong>Reactivarlas</strong> (vuelven al listado principal) o <strong>Eliminarlas</strong> permanentemente.
      </div>
  </div>

<div class="d-flex justify-content-between mb-4 align-items-center mt-2">
      <div class="col-md-5 col-lg-4">
          <form method="get">
              <div class="d-flex w-100"> 
                  <div class="search-box">
                      <i class="fa-solid fa-search search-icon"></i>
                      <input type="text" name="busqueda" value="{{ filtros.busqueda }}" 
                             class="form-control" placeholder="Buscar en papelera...">
                  </div>
                  <button class="btn btn-secondary" type="submit" 
                          style="border-top-left-radius: 0; border-bottom-left-radius: 0;">
                      Buscar
                  </button>
              </div>
          </form>
      </div>
      
      <div></div>
  </div>

  <div class="table-responsive mb-4">
    <table class="table table-hover align-middle">
      <thead class="table-secondary">
        <tr>
          <th style="width: 25%;">Empresa</th>
          <th style="width: 25%;">Fecha Baja</th>
          <th style="width: 25%;">Motivo / Notas</th>
          <th style="width: 25%;" class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for empresa in page_obj %}
        <tr>
          <td class="text-muted">
              <strong>{{ empresa.nombre }}</strong><br>
              <small>{{ empresa.cif_nif }}</small>
          </td>
          <td>{{ empresa.fecha_baja|date:"d/m/Y" }}</td>
          <td>
              <small class="text-muted fst-italic">Desactivada manual</small>
          </td>
          <td class="text-end">
            <form method="post" action="{% url 'empresas:reactivar_empresa' empresa.id %}" class="d-inline">
                {% csrf_token %}
                <button class="btn btn-success btn-sm" title="Reactivar"><i class="fa-solid fa-rotate-left"></i></button>
            </form>
            
            <button class="btn btn-danger btn-sm ms-1" data-bs-toggle="modal" data-bs-target="#eliminarDefinitivoModal{{ empresa.id }}" title="Eliminar Definitivamente">
                <i class="fa-solid fa-trash"></i>
            </button>
          </td>
        </tr>

        <div class="modal fade" id="eliminarDefinitivoModal{{ empresa.id }}" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="fa-solid fa-triangle-exclamation me-2"></i>Eliminar Empresa</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <p>¿Estás seguro de eliminar permanentemente a <strong>{{ empresa.nombre }}</strong>?</p>
                
                <div class="alert alert-danger mb-0">
                    <strong>Advertencia:</strong> Esta acción borrará:<br>
                    • Datos de la empresa<br>
                    • Contratos<br>
                    • Configuraciones de comisiones<br>
                    <br>
                    <span class="text-decoration-underline">Esta acción no se puede deshacer.</span>
                </div>
              </div>
              <div class="modal-footer">
                <a href="{% url 'empresas:eliminar_empresa' empresa.id %}" class="btn btn-danger fw-bold">Sí, Eliminar Permanentemente</a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
            </div>
          </div>
        </div>

        {% empty %}
        <tr><td colspan="4" class="text-center p-5 text-muted">La papelera está vacía.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  
  {% endblock %}