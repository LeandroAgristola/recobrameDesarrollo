{% extends 'management/layout_management.html' %}

{% block content %}
<div class="container-fluid">
    <div id="formEmpresa">
        <h3 class="mb-4 border-bottom pb-2">{{ titulo }}</h3>
        
        {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {% for error in form.non_field_errors %}
                    {{ error }}<br>
                {% endfor %}
            </div>
        {% endif %}
        
        <form method="post" enctype="multipart/form-data" id="empresaFormMain">
            {% csrf_token %}
            
            <h5 class="mt-4 mb-3"><i class="fa-solid fa-id-card me-2"></i>Datos Identificativos</h5>
            <div class="row g-3">
                
                <div class="col-md-6">
                    <label class="form-label">Nombre Comercial <span class="text-danger">*</span></label>
                    {{ form.nombre }}
                    {% if form.nombre.errors %}<div class="text-danger small">{{ form.nombre.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6">
                    <label class="form-label">Razón Social <span class="text-danger">*</span></label>
                    {{ form.razon_social }}
                    {% if form.razon_social.errors %}<div class="text-danger small">{{ form.razon_social.errors }}</div>{% endif %}
                </div>

                <div class="col-md-4">
                    <label class="form-label">CIF/NIF</label>
                    {{ form.cif_nif }}
                </div>
                <div class="col-md-4">
                    <label class="form-label">Persona Contacto (General)</label>
                    {{ form.persona_contacto }}
                    {% if form.persona_contacto.errors %}<div class="text-danger small">{{ form.persona_contacto.errors }}</div>{% endif %}
                </div>
                <div class="col-md-4">
                    <label class="form-label">Teléfono Contacto</label>
                    {{ form.telefono_contacto }}
                </div>

                <div class="col-md-6">
                    <label class="form-label">Email General</label>
                    {{ form.email_contacto }}
                </div>
                <div class="col-md-6">
                    <label class="form-label">Fecha Alta</label>
                    {{ form.fecha_alta }}
                </div>

                <div class="col-12">
                    <label class="form-label">Dirección Fiscal</label>
                    {{ form.direccion }}
                </div>
            </div>

            <h5 class="mt-4 mb-3"><i class="fa-solid fa-headset me-2"></i>Operativa e Incidencias</h5>
            <div class="row g-3">
                
                <div class="col-md-6">
                    <label class="form-label">Contacto de Incidencias <span class="text-danger">*</span></label>
                    {{ form.contacto_incidencias }}
                    {% if form.contacto_incidencias.errors %}<div class="text-danger small">{{ form.contacto_incidencias.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6">
                    <label class="form-label">Email Incidencias <span class="text-danger">*</span></label>
                    {{ form.email_incidencias }}
                    {% if form.email_incidencias.errors %}<div class="text-danger small">{{ form.email_incidencias.errors }}</div>{% endif %}
                </div>

                <div class="col-md-6">
                    <label class="form-label d-block">Tipos de Impagos <span class="text-danger">*</span></label>
                    <div class="bg-white p-3 border rounded" style="height: 150px; overflow-y: auto;">
                        {% for checkbox in form.tipos_impagos %}
                            <div class="form-check">
                                {{ checkbox.tag }}
                                <label class="form-check-label" for="{{ checkbox.id_for_label }}">
                                    {{ checkbox.choice_label }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                    {% if form.tipos_impagos.errors %}
                        <div class="text-danger small mt-1">{{ form.tipos_impagos.errors }}</div>
                    {% endif %}
                </div>

                <div class="col-md-6">
                    <label class="form-label">Cursos / Productos</label>
                    {{ form.cursos }}
                </div>

                <div class="col-md-12">
                    <label class="form-label">Datos Bancarios</label>
                    {{ form.datos_bancarios }}
                </div>
            </div>

            <h5 class="mt-4 mb-3"><i class="fa-solid fa-euro-sign me-2"></i>Configuración Económica</h5>
            
            <div class="alert alert-info border-0 d-flex align-items-center shadow-sm">
                <i class="fa-solid fa-circle-info fs-4 me-3"></i>
                <div>
                    <h6 class="mb-1 fw-bold">Configuración de Comisiones</h6>
                    <p class="mb-0 small">
                        Las reglas de comisiones (Fijas, Escalonadas, etc.) se configurarán 
                        <strong>en el siguiente paso</strong>, una vez guardada la empresa.
                    </p>
                </div>
            </div>
            <h5 class="mt-4 mb-3"><i class="fa-solid fa-file-contract me-2"></i>Legal y Notas</h5>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Contrato Colaboración <span class="text-danger">*</span></label>
                    {{ form.contrato_colaboracion }}
                    {% if form.contrato_colaboracion.errors %}
                        <div class="text-danger small">{{ form.contrato_colaboracion.errors }}</div>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <label class="form-label">Contrato Cesión (Opcional)</label>
                    {{ form.contrato_cesion }}
                </div>
                <div class="col-12">
                    <label class="form-label">Notas Internas</label>
                    {{ form.notas }}
                </div>
            </div>

            <div class="mt-5 pt-3 border-top d-flex justify-content-center gap-3">
                <a href="{% url 'empresas:lista_empresas' %}" class="btn btn-secondary px-5 py-2 fw-bold" style="width: 200px;">Cancelar</a>
                <button type="submit" class="btn btn-success px-5 py-2 fw-bold" style="width: 200px;">Siguiente</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
{% block scripts %}
{% endblock %}